services:
  app:
    build:
      context: ./Smart-Path-AI
      dockerfile: Dockerfile
    depends_on:
      - ai-server
      - mongo
    environment:
      PORT: 4000
      CLIENT_PORT: 5173
      CLIENT_URL: ${CLIENT_URL:-http://localhost:5173}
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:5173}
      SERVER_PUBLIC_URL: ${SERVER_PUBLIC_URL:-http://localhost:4000}
      GOOGLE_CALLBACK_URL: ${GOOGLE_CALLBACK_URL:-http://localhost:4000/auth/google/callback}
      MONGO_URI: ${MONGO_URI:-mongodb://mongo:27017/smartpathai}
      SESSION_SECRET: ${SESSION_SECRET:?SESSION_SECRET must be set}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:-}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:-}
      PYTHON_SERVICE_URL: http://ai-server:8000
    ports:
      - "4000:4000"
      - "5173:5173"
    restart: unless-stopped

  ai-server:
    build:
      context: ./smartpathai-aiserver
      dockerfile: Dockerfile
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      NEO4J_URI: ${NEO4J_URI}
      NEO4J_USERNAME: ${NEO4J_USERNAME}
      NEO4J_PASSWORD: ${NEO4J_PASSWORD}
    ports:
      - "8000:8000"
    restart: unless-stopped

  mongo:
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    restart: unless-stopped

volumes:
  mongo_data:
